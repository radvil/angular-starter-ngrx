(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"2yxt":function(e,t,n){"use strict";n.r(t),n.d(t,"ChatModule",function(){return nt});var s=n("ofXK"),i=n("tyNb"),c=n("3Pt+"),o=n("bTqV"),r=n("FKr1"),a=n("kmnG"),l=n("NFeN"),d=n("qFsG"),b=n("XhcP"),g=n("STbY"),u=n("0IaG"),f=n("qyIo"),h=n("M/RR"),m=n("XNiG"),O=n("xgIS"),p=n("Kj3r"),_=n("/uUt"),C=n("lJxs"),M=n("vkgz"),v=n("1G5W"),j=n("l7P3");const I=Object(j.o)("auth"),S=Object(j.q)(I,e=>e.user);Object(j.q)(I,e=>e.isLoading),Object(j.q)(I,e=>e.isLoaded),Object(j.q)(I,e=>e.error);var E=function(e){return e.GET_CONVERSATIONS="[Conversation/Api] Get Conversations",e.GET_CONVERSATIONS_SUCCESS="[Conversation/Api] Get Conversations Success",e.GET_CONVERSATIONS_FAILURE="[Conversation/Api] Get Conversations Failure",e.GET_CONVERSATION_BY_ID="[Conversation/Api] Get Conversation By Id",e.GET_CONVERSATION_BY_ID_SUCCESS="[Conversation/Api] Get Conversation By Id Success",e.GET_CONVERSATION_BY_ID_FAILURE="[Conversation/Api] Get Conversation By Id Failure",e}({});const y=Object(j.n)(E.GET_CONVERSATIONS),P=Object(j.n)(E.GET_CONVERSATIONS_SUCCESS,Object(j.s)()),T=Object(j.n)(E.GET_CONVERSATIONS_FAILURE,Object(j.s)()),w=Object(j.n)(E.GET_CONVERSATION_BY_ID,Object(j.s)()),U=Object(j.n)(E.GET_CONVERSATION_BY_ID_SUCCESS,Object(j.s)()),x=Object(j.n)(E.GET_CONVERSATION_BY_ID_FAILURE,Object(j.s)());var A=function(e){return e.GET_MESSAGES_BY_CONVERSATION="[Message/Api] Get Messages By Conversation",e.GET_MESSAGES_BY_CONVERSATION_SUCCESS="[Message/Api] Get Messages By Conversation Success",e.GET_MESSAGES_BY_CONVERSATION_FAILURE="[Message/Api] Get Messages By Conversation Failure",e.DELETE_MESSAGE_BY_ID="[Message] Delete Messsage By Id",e.CLEAR_MESSAGES="[] Clear All Messages",e.NEW_MESSAGE="[Message] New Messsage",e.NEW_MESSAGE_SUCCESS="[Message] New Messsage Success",e.NEW_MESSAGE_FAILURE="[Message] New Messsage Failure",e}({});const N=Object(j.n)(A.GET_MESSAGES_BY_CONVERSATION,Object(j.s)()),B=Object(j.n)(A.GET_MESSAGES_BY_CONVERSATION_SUCCESS,Object(j.s)()),k=Object(j.n)(A.GET_MESSAGES_BY_CONVERSATION_FAILURE,Object(j.s)()),L=Object(j.n)(A.CLEAR_MESSAGES,Object(j.s)()),G=Object(j.n)(A.DELETE_MESSAGE_BY_ID,Object(j.s)()),R=Object(j.n)(A.NEW_MESSAGE,Object(j.s)()),$=Object(j.n)(A.NEW_MESSAGE_SUCCESS,Object(j.s)()),q=Object(j.n)(A.NEW_MESSAGE_FAILURE,Object(j.s)());var V=n("fXoL"),F=n("ddfU"),D=n("AW1s");const z=["searchInput"];function Y(e,t){if(1&e){const e=V.Vb();V.Ub(0,"li",9),V.bc("click",function(){V.tc(e);const n=t.$implicit;return V.fc(2).openChat(n)}),V.Pb(1,"img",10),V.Ub(2,"span",11),V.Bc(3),V.Tb(),V.Tb()}if(2&e){const e=t.$implicit;V.Cb(1),V.lc("src",e.photo,V.uc)("alt",e.username),V.Cb(2),V.Cc(e.name)}}function H(e,t){if(1&e&&(V.Ub(0,"li",12),V.Ub(1,"b"),V.Bc(2),V.Tb(),V.Tb()),2&e){const e=V.fc().ngIf;V.Cb(2),V.Cc((null==e?null:e.length)+" user(s) found")}}function W(e,t){if(1&e&&(V.Ub(0,"ul",7),V.zc(1,Y,4,3,"li",8),V.zc(2,H,3,1,"li",5),V.Tb()),2&e){const e=t.ngIf;V.fc();const n=V.rc(5);V.Cb(1),V.lc("ngForOf",e),V.Cb(1),V.lc("ngIf",""!==n.value)}}function K(e,t){1&e&&(V.Ub(0,"div",12),V.Ub(1,"b"),V.Bc(2,"Search friend to start conversation"),V.Tb(),V.Tb())}function X(e,t){if(1&e){const e=V.Vb();V.Ub(0,"div",13),V.Ub(1,"div",14),V.Ub(2,"button",15),V.bc("click",function(){return V.tc(e),V.fc().mode="SEARCH"}),V.Ub(3,"mat-icon"),V.Bc(4,"arrow_back"),V.Tb(),V.Tb(),V.Pb(5,"img",10),V.Ub(6,"span",11),V.Bc(7),V.Tb(),V.Tb(),V.Ub(8,"form",16),V.bc("ngSubmit",function(){return V.tc(e),V.fc().submit()}),V.Ub(9,"mat-form-field",1),V.Ub(10,"mat-label"),V.Bc(11,"New message"),V.Tb(),V.Pb(12,"input",17),V.Tb(),V.Ub(13,"button",18),V.Ub(14,"mat-icon"),V.Bc(15,"send"),V.Tb(),V.Bc(16,"\xa0Send "),V.Tb(),V.Tb(),V.Tb()}if(2&e){const e=V.fc();V.Cb(5),V.lc("src",e.selectedUser.photo,V.uc)("alt",e.selectedUser.username),V.Cb(2),V.Cc(e.selectedUser.name),V.Cb(1),V.lc("formGroup",e.form)}}let J=(()=>{class e{constructor(e,t,n,s){this._userService=e,this._store=t,this._notification=n,this.dialogRef=s,this._destroy$=new m.a,this.mode="SEARCH",this.form=new c.h({message:new c.f(""),senderId:new c.f(""),receiverId:new c.f("")})}ngOnInit(){this.filteredUsers$=this._userService.searchResult$,this._store.select(S).subscribe(e=>{e&&(this.authUser=e,this.form.patchValue({senderId:e.id}))})}ngAfterViewInit(){Object(O.a)(this.input.nativeElement,"keyup").pipe(Object(p.a)(500),Object(_.a)(),Object(C.a)(e=>e.target.value),Object(M.a)(e=>{this._userService.searchUser(e)}),Object(v.a)(this._destroy$)).subscribe()}openChat(e){this.mode="CHAT",this.selectedUser=e,this.form.patchValue({receiverId:e.id})}submit(){this._store.dispatch(R({dto:this.form.value})),this._notification.success("Success!"),this.dialogRef.close()}}return e.\u0275fac=function(t){return new(t||e)(V.Ob(F.e),V.Ob(j.h),V.Ob(D.c),V.Ob(u.e))},e.\u0275cmp=V.Ib({type:e,selectors:[["app-new-chat-dialog"]],viewQuery:function(e,t){if(1&e&&V.Ec(z,1),2&e){let e;V.qc(e=V.cc())&&(t.input=e.first)}},decls:11,vars:7,consts:[[1,"search-friend"],["appearance","outline"],["matInput","","type","text","placeholder","Search friend","autocomplete","off"],["searchInput",""],["class","search-results",4,"ngIf"],["style","text-align: center",4,"ngIf"],["class","conversation-start",4,"ngIf"],[1,"search-results"],["matRipple","","class","search-result-item",3,"click",4,"ngFor","ngForOf"],["matRipple","",1,"search-result-item",3,"click"],[3,"src","alt"],[1,"name"],[2,"text-align","center"],[1,"conversation-start"],[1,"header"],["mat-icon-button","",3,"click"],[1,"content",3,"formGroup","ngSubmit"],["matInput","","type","text","formControlName","message","placeholder","Enter your message","autocomplete","off"],["type","submit","mat-raised-button","","color","primary"]],template:function(e,t){if(1&e&&(V.Ub(0,"div",0),V.Ub(1,"mat-form-field",1),V.Ub(2,"mat-label"),V.Bc(3,"Search"),V.Tb(),V.Pb(4,"input",2,3),V.Tb(),V.Ub(6,"mat-dialog-content"),V.zc(7,W,3,2,"ul",4),V.gc(8,"async"),V.zc(9,K,3,0,"div",5),V.Tb(),V.Tb(),V.zc(10,X,17,4,"div",6)),2&e){const e=V.rc(5);V.wc("display","SEARCH"===t.mode?"block":"none"),V.Cb(7),V.lc("ngIf",V.hc(8,5,t.filteredUsers$)),V.Cb(2),V.lc("ngIf",""===e.value),V.Cb(1),V.lc("ngIf","CHAT"===t.mode&&t.selectedUser)}},directives:[a.c,a.f,d.b,u.c,s.l,s.k,r.q,o.a,l.a,c.w,c.p,c.i,c.c,c.o,c.g],pipes:[s.b],styles:[".search-friend[_ngcontent-%COMP%]{padding:1rem}.search-friend[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.search-results[_ngcontent-%COMP%]{padding:0;list-style:none}.search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]{padding:.5rem;margin-bottom:1rem;display:flex;align-items:center;cursor:pointer;border-radius:2rem}.search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]:hover{background-color:rgba(51,51,51,.2)}.search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:40px;border-radius:50%;margin-right:1rem}.conversation-start[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem 0}.conversation-start[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:40px;border-radius:50%}.conversation-start[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:1rem;margin-left:1rem}.conversation-start[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1rem}.conversation-start[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.conversation-start[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{align-self:flex-end}"]}),e})(),Q=(()=>{class e{constructor(){}setDrawer(e){this._drawer=e}toggle(){var e;null===(e=this._drawer)||void 0===e||e.toggle()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=V.Kb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Z=(()=>{class e{constructor(e,t){this._drawerService=e,this._dialog=t}ngOnInit(){}toggleDrawer(){this._drawerService.toggle()}openNewChatDialog(){this._dialog.open(J,{width:"444px",panelClass:"new-chat-panel"})}}return e.\u0275fac=function(t){return new(t||e)(V.Ob(Q),V.Ob(u.b))},e.\u0275cmp=V.Ib({type:e,selectors:[["app-chat-empty"]],decls:8,vars:0,consts:[[1,"container"],["mat-fab","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"]],template:function(e,t){1&e&&(V.Ub(0,"div",0),V.Ub(1,"button",1),V.bc("click",function(e){return e&&t.toggleDrawer()}),V.Ub(2,"mat-icon"),V.Bc(3,"menu"),V.Tb(),V.Tb(),V.Ub(4,"button",2),V.bc("click",function(){return t.openNewChatDialog()}),V.Ub(5,"mat-icon"),V.Bc(6,"add"),V.Tb(),V.Bc(7,"\xa0New Conversation "),V.Tb(),V.Tb())},directives:[o.a,l.a],styles:[".container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center;position:relative}.container[_ngcontent-%COMP%]   [mat-fab][_ngcontent-%COMP%]{position:absolute;top:1rem;left:1rem}.container[_ngcontent-%COMP%]   [mat-raised-button][_ngcontent-%COMP%]{padding:1rem 2rem}"]}),e})();const ee={EntitiesOnly:0,Both:1,None:2};function te(e){return function(t,n){const s={ids:[...n.ids],entities:Object.assign({},n.entities)},i=e(t,s);return i===ee.Both?Object.assign({},n,s):i===ee.EntitiesOnly?Object.assign(Object.assign({},n),{entities:s.entities}):n}}function ne(e,t){const n=t(e);return Object(V.X)()&&void 0===n&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",e,"The `selectId` implementation:",t.toString()),n}function se(e){function t(t,n){const s=ne(t,e);return s in n.entities?ee.None:(n.ids.push(s),n.entities[s]=t,ee.Both)}function n(e,n){let s=!1;for(const i of e)s=t(i,n)!==ee.None||s;return s?ee.Both:ee.None}function s(e,t){return t.ids=[],t.entities={},n(e,t),ee.Both}function i(e,t){const n=(e instanceof Array?e:t.ids.filter(n=>e(t.entities[n]))).filter(e=>e in t.entities).map(e=>delete t.entities[e]).length>0;return n&&(t.ids=t.ids.filter(e=>e in t.entities)),n?ee.Both:ee.None}function c(e,t){return o([e],t)}function o(t,n){const s={};return(t=t.filter(e=>e.id in n.entities)).length>0?t.filter(t=>function(t,n,s){const i=Object.assign({},s.entities[n.id],n.changes),c=ne(i,e),o=c!==n.id;return o&&(t[n.id]=c,delete s.entities[n.id]),s.entities[c]=i,o}(s,t,n)).length>0?(n.ids=n.ids.map(e=>s[e]||e),ee.Both):ee.EntitiesOnly:ee.None}function r(t,s){const i=[],c=[];for(const n of t){const t=ne(n,e);t in s.entities?c.push({id:t,changes:n}):i.push(n)}const r=o(c,s),a=n(i,s);switch(!0){case a===ee.None&&r===ee.None:return ee.None;case a===ee.Both||r===ee.Both:return ee.Both;default:return ee.EntitiesOnly}}return{removeAll:function(e){return Object.assign({},e,{ids:[],entities:{}})},addOne:te(t),addMany:te(n),addAll:te(s),setAll:te(s),setOne:te(function(t,n){const s=ne(t,e);return s in n.entities?(n.entities[s]=t,ee.EntitiesOnly):(n.ids.push(s),n.entities[s]=t,ee.Both)}),updateOne:te(c),updateMany:te(o),upsertOne:te(function(e,t){return r([e],t)}),upsertMany:te(r),removeOne:te(function(e,t){return i([e],t)}),removeMany:te(i),map:te(function(e,t){return o(t.ids.reduce((n,s)=>{const i=e(t.entities[s]);return i!==t.entities[s]&&n.push({id:s,changes:i}),n},[]).filter(({id:e})=>e in t.entities),t)}),mapOne:te(function({map:e,id:t},n){const s=n.entities[t];return s?c({id:t,changes:e(s)},n):ee.None})}}function ie(e={}){const{selectId:t,sortComparer:n}=Object.assign({sortComparer:!1,selectId:e=>e.id},e),s={getInitialState:function(e={}){return Object.assign({ids:[],entities:{}},e)}},i={getSelectors:function(e){const t=e=>e.ids,n=e=>e.entities,s=Object(j.q)(t,n,(e,t)=>e.map(e=>t[e])),i=Object(j.q)(t,e=>e.length);return e?{selectIds:Object(j.q)(e,t),selectEntities:Object(j.q)(e,n),selectAll:Object(j.q)(e,s),selectTotal:Object(j.q)(e,i)}:{selectIds:t,selectEntities:n,selectAll:s,selectTotal:i}}},c=n?function(e,t){const{removeOne:n,removeMany:s,removeAll:i}=se(e);function c(e,t){return o([e],t)}function o(t,n){const s=t.filter(t=>!(ne(t,e)in n.entities));return 0===s.length?ee.None:(b(s,n),ee.Both)}function r(e,t){return t.entities={},t.ids=[],o(e,t),ee.Both}function a(e,t){return l([e],t)}function l(t,n){const s=[],i=t.filter(t=>function(t,n,s){if(!(n.id in s.entities))return!1;const i=Object.assign({},s.entities[n.id],n.changes),c=ne(i,e);return delete s.entities[n.id],t.push(i),c!==n.id}(s,t,n)).length>0;if(0===s.length)return ee.None;{const e=n.ids,t=[];return n.ids=n.ids.filter((e,s)=>e in n.entities||(t.push(s),!1)),b(s,n),!i&&t.every(t=>n.ids[t]===e[t])?ee.EntitiesOnly:ee.Both}}function d(t,n){const s=[],i=[];for(const o of t){const t=ne(o,e);t in n.entities?i.push({id:t,changes:o}):s.push(o)}const c=l(i,n),r=o(s,n);switch(!0){case r===ee.None&&c===ee.None:return ee.None;case r===ee.Both||c===ee.Both:return ee.Both;default:return ee.EntitiesOnly}}function b(n,s){n.sort(t);const i=[];let c=0,o=0;for(;c<n.length&&o<s.ids.length;){const r=n[c],a=ne(r,e),l=s.ids[o];t(r,s.entities[l])<=0?(i.push(a),c++):(i.push(l),o++)}s.ids=i.concat(c<n.length?n.slice(c).map(e):s.ids.slice(o)),n.forEach((t,n)=>{s.entities[e(t)]=t})}return{removeOne:n,removeMany:s,removeAll:i,addOne:te(c),updateOne:te(a),upsertOne:te(function(e,t){return d([e],t)}),addAll:te(r),setAll:te(r),setOne:te(function(t,n){const s=ne(t,e);return s in n.entities?(n.ids=n.ids.filter(e=>e!==s),b([t],n),ee.Both):c(t,n)}),addMany:te(o),updateMany:te(l),upsertMany:te(d),map:te(function(e,t){return l(t.ids.reduce((n,s)=>{const i=e(t.entities[s]);return i!==t.entities[s]&&n.push({id:s,changes:i}),n},[]),t)}),mapOne:te(function({map:e,id:t},n){const s=n.entities[t];return s?a({id:t,changes:e(s)},n):ee.None})}}(t,n):se(t);return Object.assign(Object.assign(Object.assign({selectId:t,sortComparer:n},s),i),c)}ee[ee.EntitiesOnly]="EntitiesOnly",ee[ee.Both]="Both",ee[ee.None]="None";var ce=n("JAgN");const oe=ie({selectId:e=>e.id,sortComparer:ce.a}),re=oe.getInitialState({isLoading:!1,isLoaded:!1,selectedId:null,error:null}),ae=ie({selectId:e=>e.id,sortComparer:ce.b}),le=ae.getInitialState({isLoading:!1,isLoaded:!1,selectedId:null,conversationId:null,error:null}),de=Object(j.p)(re,Object(j.r)(y,e=>Object.assign(Object.assign({},e),{isLoaded:!1,isLoading:!0})),Object(j.r)(P,(e,{conversations:t})=>oe.setAll(t,Object.assign(Object.assign({},e),{isLoaded:!0,isLoading:!1}))),Object(j.r)(T,(e,{error:t})=>Object.assign(Object.assign({},e),{isLoading:!1,error:t})),Object(j.r)(w,(e,{selectedId:t})=>Object.assign(Object.assign({},e),{isLoaded:!1,isLoading:!0,selectedId:t})),Object(j.r)(U,(e,{conversation:t})=>oe.upsertOne(t,Object.assign(Object.assign({},e),{isLoaded:!0,isLoading:!1})))),be=Object(j.p)(le,Object(j.r)(N,(e,{conversationId:t})=>Object.assign(Object.assign({},e),{isLoaded:!1,isLoading:!0,conversationId:t})),Object(j.r)(B,(e,{messages:t})=>ae.setAll(t,Object.assign(Object.assign({},e),{isLoaded:!0,isLoading:!1}))),Object(j.r)(k,(e,{error:t})=>Object.assign(Object.assign({},e),{isLoading:!1,error:t})),Object(j.r)(L,(e,{conversationId:t})=>{const n=Object.keys(e.entities).reduce((n,s)=>{var i;return(null===(i=e.entities[s])||void 0===i?void 0:i.conversationId)===t&&n.push(s),console.log(n.length),n},[]);return ae.removeMany(n,Object.assign(Object.assign({},e),{isLoaded:!1,isLoading:!0}))}),Object(j.r)(G,(e,{selectedId:t})=>ae.removeOne(t,Object.assign(Object.assign({},e),{isLoaded:!1,isLoading:!0}))),Object(j.r)(R,e=>Object.assign(Object.assign({},e),{isLoaded:!1,isLoading:!0})),Object(j.r)($,(e,{newMessage:t})=>ae.addOne(t,Object.assign(Object.assign({},e),{isLoaded:!0,isLoading:!1}))),Object(j.r)(q,(e,{error:t})=>Object.assign(Object.assign({},e),{isLoaded:!1,isLoading:!1,error:t}))),ge="chat",ue={conversations:de,messages:be},{selectEntities:fe,selectAll:he}=oe.getSelectors(),me=Object(j.o)(ge),Oe=Object(j.q)(me,e=>e.conversations),pe=Object(j.q)(Oe,he),_e=Object(j.q)(Oe,fe),Ce=Object(j.q)(Oe,e=>e.selectedId),Me=Object(j.q)(Oe,e=>e.isLoading),ve=Object(j.q)(Oe,e=>e.isLoaded),je=(Object(j.q)(Oe,e=>e.error),Object(j.q)(_e,Ce,(e,t)=>t?e[t]:void 0)),{selectEntities:Ie,selectAll:Se}=ae.getSelectors(),Ee=Object(j.q)(me,e=>e.messages),ye=Object(j.q)(Ee,Se),Pe=(Object(j.q)(Ee,Ie),Object(j.q)(Ee,e=>e.selectedId),Object(j.q)(Ee,e=>e.isLoading)),Te=(Object(j.q)(Ee,e=>e.isLoaded),Object(j.q)(Ee,e=>e.error),Object(j.q)(ye,Ce,(e,t)=>t?e.filter(e=>e.conversationId===t):void 0));var we=n("7q9M"),Ue=n("KnKh"),xe=n("cWSB");const Ae=["drawer"];function Ne(e,t){if(1&e){const e=V.Vb();V.Ub(0,"mat-icon",9),V.bc("click",function(){return V.tc(e),V.fc(),V.rc(3).close()}),V.Bc(1,"close"),V.Tb()}}function Be(e,t){1&e&&(V.Ub(0,"li",10),V.Ub(1,"h3"),V.Bc(2,"\ud83d\udcac Loading..."),V.Tb(),V.Tb())}function ke(e,t){if(1&e&&(V.Ub(0,"p",4),V.Bc(1),V.gc(2,"truncate"),V.Tb()),2&e){const e=V.fc().$implicit;V.Cb(1),V.Dc(" ",V.ic(2,1,e.chats[0].message,18)," ")}}function Le(e,t){if(1&e&&(V.Ub(0,"div",17),V.Bc(1),V.gc(2,"relativeTime"),V.Tb()),2&e){const e=V.fc().$implicit;V.Cb(1),V.Dc(" ",V.ic(2,1,e.updatedAt.toString(),"short")," ")}}function Ge(e,t){if(1&e){const e=V.Vb();V.Ub(0,"li",12),V.bc("click",function(){V.tc(e);const n=t.$implicit;return V.fc(2).goToConversation(n)}),V.Pb(1,"img",13),V.Ub(2,"div",14),V.Ub(3,"h3",4),V.Bc(4),V.gc(5,"truncate"),V.Tb(),V.zc(6,ke,3,4,"p",15),V.Tb(),V.zc(7,Le,3,4,"div",16),V.Tb()}if(2&e){const e=t.$implicit;V.Cb(1),V.lc("src",e.from.photo,V.uc)("alt",e.from.username),V.Cb(3),V.Cc(V.ic(5,5,e.from.name,15)),V.Cb(2),V.lc("ngIf",e.chats&&e.chats[0]),V.Cb(1),V.lc("ngIf",e.updatedAt)}}function Re(e,t){if(1&e&&(V.Sb(0),V.zc(1,Ge,8,8,"li",11),V.gc(2,"async"),V.Rb()),2&e){const e=V.fc();V.Cb(1),V.lc("ngForOf",V.hc(2,1,e.conversations$))}}let $e=(()=>{class e{constructor(e,t,n,s){this._drawerService=e,this._store=t,this._router=n,this._bpService=s,this._destroy$=new m.a,this.isHandset=!1,this.conversations$=this._store.select(pe),this.isLoading$=this._store.select(Me),this.isLoaded$=this._store.select(ve)}ngOnInit(){this._store.dispatch(y())}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}ngAfterViewInit(){this._drawerService.setDrawer(this.drawer),this._bpService.isHandset().subscribe(e=>{e?this.isHandset=!0:(this.drawer.mode="side",this.drawer.opened=!0)})}goToConversation(e){this._router.navigate(["chat",e.id]),this.isHandset&&this.drawer.close()}}return e.\u0275fac=function(t){return new(t||e)(V.Ob(Q),V.Ob(j.h),V.Ob(i.f),V.Ob(D.a))},e.\u0275cmp=V.Ib({type:e,selectors:[["app-chat"]],viewQuery:function(e,t){if(1&e&&V.Ec(Ae,3),2&e){let e;V.qc(e=V.cc())&&(t.drawer=e.first)}},decls:16,vars:7,consts:[[1,"drawer-container"],["drawer",""],[1,"chats--list"],[1,"chats--list-header"],[1,"m0"],[1,"fx-spacer"],[3,"click",4,"ngIf"],["class","chats--loading",4,"ngIf"],[4,"ngIf"],[3,"click"],[1,"chats--loading"],["matRipple","","mat-list-item","","class","chats--list-item",3,"click",4,"ngFor","ngForOf"],["matRipple","","mat-list-item","",1,"chats--list-item",3,"click"],["width","45",3,"src","alt"],[1,"fx-spacer","df","fdc","jcc"],["class","m0",4,"ngIf"],["class","time",4,"ngIf"],[1,"time"]],template:function(e,t){1&e&&(V.Ub(0,"rad-card"),V.Ub(1,"mat-drawer-container",0),V.Ub(2,"mat-drawer",null,1),V.Ub(4,"ul",2),V.Ub(5,"li",3),V.Ub(6,"h1",4),V.Bc(7,"Chats"),V.Tb(),V.Pb(8,"span",5),V.zc(9,Ne,2,0,"mat-icon",6),V.Tb(),V.zc(10,Be,3,0,"li",7),V.gc(11,"async"),V.zc(12,Re,3,3,"ng-container",8),V.gc(13,"async"),V.Tb(),V.Tb(),V.Ub(14,"mat-drawer-content"),V.Pb(15,"router-outlet"),V.Tb(),V.Tb(),V.Tb()),2&e&&(V.Cb(9),V.lc("ngIf",t.isHandset),V.Cb(1),V.lc("ngIf",V.hc(11,3,t.isLoading$)),V.Cb(2),V.lc("ngIf",V.hc(13,5,t.isLoaded$)))},directives:[we.a,b.b,b.a,s.l,b.c,i.k,l.a,s.k,r.q],pipes:[s.b,Ue.a,xe.a],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%}rad-card[_ngcontent-%COMP%]{width:100%;height:100%;padding:0}.drawer-container[_ngcontent-%COMP%]{background-color:initial;height:100%;width:100%}mat-drawer[_ngcontent-%COMP%]{width:330px}mat-drawer[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], mat-drawer[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:700}.chats--list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.chats--list-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem}.chats--list-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{cursor:pointer}.chats--loading[_ngcontent-%COMP%]{height:200px;display:flex;align-items:center;justify-content:center}.chats--list-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem;cursor:pointer}.chats--list-item.active[_ngcontent-%COMP%], .chats--list-item[_ngcontent-%COMP%]:hover{background-color:hsla(0,0%,52.5%,.2)}.chats--list-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;margin-right:1rem}.chats--list-item[_ngcontent-%COMP%]   .fx-spacer[_ngcontent-%COMP%]{margin-right:1rem}mat-drawer-content[_ngcontent-%COMP%]{background-image:url(chatting.d6e180e36638f1c7df32.svg);background-size:contain;background-repeat:no-repeat;background-position-x:right;background-position-y:bottom}"]}),e})();var qe=n("pLZG");function Ve(e,t){if(1&e){const e=V.Vb();V.Ub(0,"button",11),V.bc("click",function(){return V.tc(e),V.fc(2).clearChat()}),V.Ub(1,"mat-icon",12),V.Bc(2,"checked"),V.Tb(),V.Bc(3," Clear Chats "),V.Tb()}}function Fe(e,t){if(1&e&&V.Pb(0,"img",25),2&e){const e=V.fc(4).ngIf;V.lc("src",null==e||null==e.from?null:e.from.photo,V.uc)}}function De(e,t){if(1&e){const e=V.Vb();V.Ub(0,"li"),V.zc(1,Fe,1,1,"img",23),V.Ub(2,"div",24),V.bc("contextmenu",function(n){V.tc(e);const s=t.$implicit,i=V.fc(2).ngIf,c=V.fc(2);return i.id===s.senderId?c.onContextMenu(n,s):null}),V.Bc(3),V.Tb(),V.Tb()}if(2&e){const e=t.$implicit,n=V.fc(2).ngIf;V.Gb("self",e.senderId===n.id),V.Cb(1),V.lc("ngIf",e.senderId!==n.id),V.Cb(2),V.Dc(" ",e.message," ")}}function ze(e,t){if(1&e&&(V.Ub(0,"ul",21),V.zc(1,De,4,4,"li",22),V.Tb()),2&e){const e=t.ngIf;V.Cb(1),V.lc("ngForOf",e)}}function Ye(e,t){if(1&e){const e=V.Vb();V.Ub(0,"div",13),V.Ub(1,"div",14),V.zc(2,ze,2,1,"ul",15),V.gc(3,"async"),V.Tb(),V.Ub(4,"div",16),V.Pb(5,"img",17),V.Ub(6,"div",18),V.Ub(7,"input",19),V.bc("ngModelChange",function(t){return V.tc(e),V.fc(2).newMessage=t})("keyup",function(n){V.tc(e);const s=t.ngIf,i=V.fc().ngIf,c=V.fc();return"Enter"===n.code?c.sendMessage(s.id,i.from.id):null}),V.Tb(),V.Tb(),V.Ub(8,"button",20),V.bc("click",function(){V.tc(e);const n=t.ngIf,s=V.fc().ngIf;return V.fc().sendMessage(n.id,s.from.id)}),V.Ub(9,"mat-icon"),V.Bc(10,"send"),V.Tb(),V.Tb(),V.Tb(),V.Tb()}if(2&e){const e=t.ngIf,n=V.fc(2);V.Cb(2),V.lc("ngIf",V.hc(3,4,n.messages$)),V.Cb(3),V.lc("src",e.photo,V.uc)("alt",e.username),V.Cb(2),V.lc("ngModel",n.newMessage)}}function He(e,t){if(1&e){const e=V.Vb();V.Sb(0),V.Ub(1,"div",4),V.Ub(2,"button",5),V.bc("click",function(){return V.tc(e),V.fc().toggleDrawer()}),V.Ub(3,"mat-icon"),V.Bc(4,"menu"),V.Tb(),V.Tb(),V.Pb(5,"img",6),V.Ub(6,"h3"),V.Bc(7),V.Tb(),V.Pb(8,"span",7),V.Ub(9,"button",8),V.Ub(10,"mat-icon"),V.Bc(11,"settings"),V.Tb(),V.Tb(),V.Ub(12,"mat-menu",null,9),V.zc(14,Ve,4,0,"ng-template",3),V.Tb(),V.Tb(),V.zc(15,Ye,11,6,"div",10),V.gc(16,"async"),V.Rb()}if(2&e){const e=t.ngIf,n=V.rc(13),s=V.fc();V.Cb(5),V.lc("src",null==e||null==e.from?null:e.from.photo,V.uc),V.Cb(2),V.Cc(null==e||null==e.from?null:e.from.name),V.Cb(2),V.lc("matMenuTriggerFor",n),V.Cb(6),V.lc("ngIf",V.hc(16,4,s.currentUser$))}}function We(e,t){if(1&e){const e=V.Vb();V.Ub(0,"button",11),V.bc("click",function(){V.tc(e);const n=t.item;return V.fc().deleteMessage(n)}),V.Ub(1,"mat-icon",12),V.Bc(2,"delete"),V.Tb(),V.Bc(3," \xa0Delete "),V.Tb()}}let Ke=(()=>{class e{constructor(e,t,n,s,i){this._route=e,this._drawerService=t,this._store=n,this._dialog=s,this._notification=i,this._destroy$=new m.a,this.currentUser$=this._store.select(S),this.conversation$=this._store.select(je),this.isLoading$=this._store.select(Pe),this.messages$=this._store.select(Te),this.contextMenuPosition={x:"0px",y:"0px"},this.newMessage=""}ngOnInit(){this._route.params.pipe(Object(v.a)(this._destroy$)).subscribe(e=>{this._convId=e.conversationId,this._store.dispatch(w({selectedId:this._convId})),this._store.dispatch(N({conversationId:this._convId}))})}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}toggleDrawer(){this._drawerService.toggle()}clearChat(){this._dialog.open(f.a,{width:"444px",data:{message:"Are You Sure ? Note that you can not undo this operation."}}).beforeClosed().pipe(Object(qe.a)(e=>e),Object(v.a)(this._destroy$)).subscribe(()=>{this._store.dispatch(L({conversationId:this._convId})),this._notification.success("Chats has been cleared!")})}onContextMenu(e,t){e.preventDefault(),this.contextMenuPosition.x=e.clientX+"px",this.contextMenuPosition.y=e.clientY+"px",this.contextMenu.menuData={item:t},this.contextMenu.menu.focusFirstItem("mouse"),this.contextMenu.openMenu()}deleteMessage(e){this._dialog.open(f.a,{width:"444px",data:{message:"Are You Sure ? Note that you can not undo this operation."}}).beforeClosed().pipe(Object(qe.a)(e=>e),Object(v.a)(this._destroy$)).subscribe(()=>{this._store.dispatch(G({selectedId:e.id})),this._notification.success("Message deleted!")})}sendMessage(e,t){this._store.dispatch(R({dto:{conversationId:this._convId,message:this.newMessage,senderId:e,receiverId:t}})),this.newMessage=""}}return e.\u0275fac=function(t){return new(t||e)(V.Ob(i.a),V.Ob(Q),V.Ob(j.h),V.Ob(u.b),V.Ob(D.c))},e.\u0275cmp=V.Ib({type:e,selectors:[["app-conversation"]],viewQuery:function(e,t){if(1&e&&V.Ec(g.e,3),2&e){let e;V.qc(e=V.cc())&&(t.contextMenu=e.first)}},decls:6,vars:8,consts:[[4,"ngIf"],[2,"visibility","hidden","position","fixed",3,"matMenuTriggerFor"],["contextMenu","matMenu"],["matMenuContent",""],[1,"toolbar","rad-bg"],["mat-icon-button","",3,"click"],["alt","photo","width","46",3,"src"],[1,"fx-spacer"],["mat-icon-button","",3,"matMenuTriggerFor"],["settingsMenu","matMenu"],["class","messages--content",4,"ngIf"],["mat-menu-item","",3,"click"],["color","warn"],[1,"messages--content"],[1,"messages--scroll-container"],["class","messages--list",4,"ngIf"],[1,"message-box"],[1,"portrait",3,"src","alt"],[1,"fx-spacer","form-control"],["matInput","","type","text","autocomplete","off","placeholder","Enter your message",3,"ngModel","ngModelChange","keyup"],["mat-icon-button","",1,"send",3,"click"],[1,"messages--list"],[3,"self",4,"ngFor","ngForOf"],["class","sender","alt","sender",3,"src",4,"ngIf"],[1,"messages--list-item",3,"contextmenu"],["alt","sender",1,"sender",3,"src"]],template:function(e,t){if(1&e&&(V.zc(0,He,17,6,"ng-container",0),V.gc(1,"async"),V.Pb(2,"div",1),V.Ub(3,"mat-menu",null,2),V.zc(5,We,4,0,"ng-template",3),V.Tb()),2&e){const e=V.rc(4);V.lc("ngIf",V.hc(1,6,t.conversation$)),V.Cb(2),V.wc("left",t.contextMenuPosition.x)("top",t.contextMenuPosition.y),V.lc("matMenuTriggerFor",e)}},directives:[s.l,g.e,g.a,g.b,o.a,l.a,g.c,d.b,c.c,c.o,c.r,s.k],pipes:[s.b],styles:[".toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.5rem;border-bottom:1px solid rgba(51,51,51,.2)}.toolbar[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:.5rem}.toolbar[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:last-child{margin-right:unset}.toolbar[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.toolbar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%}.messages--content[_ngcontent-%COMP%]{overflow:hidden}.messages--content[_ngcontent-%COMP%]   .messages--scroll-container[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:auto;height:calc(100vh - 233px);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}ul.messages--list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:.5rem}ul.messages--list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex}ul.messages--list[_ngcontent-%COMP%]   li.self[_ngcontent-%COMP%]{justify-content:flex-end;padding-left:50px}ul.messages--list[_ngcontent-%COMP%]   li.self[_ngcontent-%COMP%]   .messages--list-item[_ngcontent-%COMP%]{color:#fff;background-color:#5c77ff;border-bottom-right-radius:0;border-top-left-radius:.5rem}ul.messages--list[_ngcontent-%COMP%]   .sender[_ngcontent-%COMP%]{margin-right:.5rem;height:40px;border-radius:50%}ul.messages--list[_ngcontent-%COMP%]   .messages--list-item[_ngcontent-%COMP%]{margin-bottom:1rem;padding:.5rem 1rem;border-radius:.5rem;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;border:1px solid #ccc;border-top-left-radius:0}.message-box[_ngcontent-%COMP%]{display:flex;align-items:center;position:absolute;bottom:0;left:0;width:-webkit-fill-available;padding:.5rem;background-color:#fff;border-top:1px solid rgba(51,51,51,.2)}.message-box[_ngcontent-%COMP%]   .portrait[_ngcontent-%COMP%]{margin-right:.5rem;height:40px;border-radius:50%}.message-box[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{padding:.5rem;display:flex;align-items:center;background-color:#ececec;border-radius:2rem}.message-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:#ececec;box-sizing:border-box;border-radius:1rem;border:none;outline:none;width:100%;font-size:1rem}.message-box[_ngcontent-%COMP%]   .send[_ngcontent-%COMP%]{margin-left:.5rem}@media (min-width:777px){ul.messages--list[_ngcontent-%COMP%]{margin:1rem}ul.messages--list[_ngcontent-%COMP%]   .messages--list-item[_ngcontent-%COMP%]{font-size:1rem}ul.messages--list[_ngcontent-%COMP%]   .sender[_ngcontent-%COMP%]{margin-right:1rem}.message-box[_ngcontent-%COMP%]{padding:.5rem 1rem}.message-box[_ngcontent-%COMP%]   .potrait[_ngcontent-%COMP%]{margin-right:1rem}.message-box[_ngcontent-%COMP%]   .send[_ngcontent-%COMP%]{margin-left:1rem}.message-box[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{padding:1rem}}"]}),e})();var Xe=n("9jGm"),Je=n("LRne"),Qe=n("eIep"),Ze=n("JIr8");let et=(()=>{class e{constructor(e,t){this._actions=e,this._chatService=t,this.getConvs$=Object(Xe.c)(()=>this._actions.pipe(Object(Xe.d)(y),Object(Qe.a)(()=>this._chatService.getConversations().pipe(Object(C.a)(e=>P({conversations:e})),Object(Ze.a)(e=>Object(Je.a)(T({error:e}))))))),this.getConvById$=Object(Xe.c)(()=>this._actions.pipe(Object(Xe.d)(w),Object(Qe.a)(({selectedId:e})=>this._chatService.getConversationById(e).pipe(Object(C.a)(e=>U({conversation:e})),Object(Ze.a)(e=>Object(Je.a)(x({error:e}))))))),this.getMessagesByConversation$=Object(Xe.c)(()=>this._actions.pipe(Object(Xe.d)(N),Object(Qe.a)(({conversationId:e})=>this._chatService.getMessagesByConversation(e).pipe(Object(C.a)(e=>B({messages:e})),Object(Ze.a)(e=>Object(Je.a)(e)))))),this.addNewMessage$=Object(Xe.c)(()=>this._actions.pipe(Object(Xe.d)(R),Object(Qe.a)(({dto:e})=>this._chatService.addNewMessage(e).pipe(Object(C.a)(e=>$({newMessage:e})),Object(Ze.a)(e=>Object(Je.a)(q({error:e})))))))}}return e.\u0275fac=function(t){return new(t||e)(V.Yb(Xe.a),V.Yb(F.a))},e.\u0275prov=V.Kb({token:e,factory:e.\u0275fac}),e})(),tt=(()=>{class e{}return e.\u0275mod=V.Mb({type:e}),e.\u0275inj=V.Lb({factory:function(t){return new(t||e)},imports:[[j.j.forFeature(ge,ue),Xe.b.forFeature([et])]]}),e})(),nt=(()=>{class e{}return e.\u0275mod=V.Mb({type:e}),e.\u0275inj=V.Lb({factory:function(t){return new(t||e)},imports:[[s.c,c.k,c.t,i.j.forChild([{path:"",component:$e,children:[{path:"",redirectTo:"start-conversation"},{path:"start-conversation",component:Z,data:{title:"Start Conversation"}},{path:":conversationId",component:Ke,data:{title:"Conversation"}}]}]),b.f,o.b,l.b,a.e,d.c,g.d,u.d,r.r,f.e,h.a,tt]]}),e})()}}]);